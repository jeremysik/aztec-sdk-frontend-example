"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.groupUserTxs = void 0;
const bridge_id_1 = require("@aztec/barretenberg/bridge_id");
const client_proofs_1 = require("@aztec/barretenberg/client_proofs");
const user_tx_1 = require("../user_tx");
const emptyAssetValue = { assetId: 0, value: BigInt(0) };
const toUserAccountTx = ({ txId, userId, aliasHash, newSigningPubKey1, newSigningPubKey2, migrated, created, settled }, fee) => new user_tx_1.UserAccountTx(txId, userId, aliasHash, newSigningPubKey1, newSigningPubKey2, migrated, fee, created, settled);
const toUserPaymentTx = ({ txId, userId, proofId, publicOwner, isSender, created, settled }, value, fee) => {
    return new user_tx_1.UserPaymentTx(txId, userId, proofId, value, fee, publicOwner, isSender, created, settled);
};
const getUserDefiInteractionResultState = ({ settled, finalised, claimSettled }) => {
    if (claimSettled) {
        return user_tx_1.UserDefiInteractionResultState.SETTLED;
    }
    if (finalised) {
        return user_tx_1.UserDefiInteractionResultState.AWAITING_SETTLEMENT;
    }
    if (settled) {
        return user_tx_1.UserDefiInteractionResultState.AWAITING_FINALISATION;
    }
    return user_tx_1.UserDefiInteractionResultState.PENDING;
};
const toUserDefiTx = (tx, fee) => {
    const { txId, userId, bridgeId, depositValue, created, settled, interactionNonce, isAsync, success, outputValueA, outputValueB, finalised, claimSettled, } = tx;
    const state = getUserDefiInteractionResultState(tx);
    return new user_tx_1.UserDefiTx(txId, userId, bridgeId, { assetId: bridgeId.inputAssetIdA, value: depositValue }, fee, created, settled, {
        state,
        isAsync,
        interactionNonce,
        success,
        outputValueA: outputValueA !== undefined
            ? {
                assetId: bridgeId.firstOutputVirtual ? interactionNonce + bridge_id_1.virtualAssetIdFlag : bridgeId.outputAssetIdA,
                value: outputValueA,
            }
            : undefined,
        outputValueB: outputValueB !== undefined && bridgeId.outputAssetIdB !== undefined
            ? {
                assetId: bridgeId.secondOutputVirtual ? interactionNonce + bridge_id_1.virtualAssetIdFlag : bridgeId.outputAssetIdB,
                value: outputValueB,
            }
            : undefined,
        claimSettled,
        finalised,
    });
};
const toUserDefiClaimTx = (claimTxId, { txId, userId, bridgeId, depositValue, interactionResult: { success, outputValueA, outputValueB, claimSettled }, }) => new user_tx_1.UserDefiClaimTx(claimTxId, txId, userId, bridgeId, depositValue, success, outputValueA, outputValueB, claimSettled);
const getPaymentValue = ({ proofId, assetId, publicValue, privateInput, recipientPrivateOutput, senderPrivateOutput, isRecipient, }) => {
    const value = (() => {
        switch (proofId) {
            case client_proofs_1.ProofId.DEPOSIT: {
                const outputValue = recipientPrivateOutput + senderPrivateOutput;
                return outputValue || isRecipient ? outputValue : publicValue;
            }
            case client_proofs_1.ProofId.WITHDRAW:
                return publicValue;
            case client_proofs_1.ProofId.SEND:
                if (isRecipient || recipientPrivateOutput) {
                    return recipientPrivateOutput;
                }
                return privateInput;
        }
    })();
    return { assetId, value };
};
const getFee = (tx) => {
    if (tx.proofId === client_proofs_1.ProofId.ACCOUNT) {
        return emptyAssetValue;
    }
    if (tx.proofId === client_proofs_1.ProofId.DEFI_DEPOSIT) {
        const { bridgeId, txFee } = tx;
        return { assetId: bridgeId.inputAssetIdA, value: txFee };
    }
    const { proofId, assetId, publicValue, privateInput, recipientPrivateOutput, senderPrivateOutput, isRecipient, isSender, } = tx;
    const value = (() => {
        switch (proofId) {
            case client_proofs_1.ProofId.DEPOSIT: {
                const outputValue = recipientPrivateOutput + senderPrivateOutput;
                return outputValue || (isSender && isRecipient) ? publicValue - outputValue : BigInt(0);
            }
            case client_proofs_1.ProofId.WITHDRAW:
                return privateInput - publicValue;
            case client_proofs_1.ProofId.SEND:
                if (!isSender || (!isRecipient && !recipientPrivateOutput)) {
                    return BigInt(0);
                }
                return privateInput - recipientPrivateOutput - senderPrivateOutput;
        }
    })();
    return {
        assetId,
        value,
    };
};
const getTotalFee = (txs) => {
    if (!txs.length) {
        return emptyAssetValue;
    }
    const fees = txs.map(getFee);
    const { assetId } = fees.find(fee => fee.value) || fees[0];
    if (fees.some(fee => fee.value && fee.assetId !== assetId)) {
        throw new Error('Inconsistent fee paying assets.');
    }
    return { assetId, value: fees.reduce((sum, fee) => sum + fee.value, BigInt(0)) };
};
const getPrimaryTx = (txs) => txs.find(tx => !tx.txRefNo) ||
    txs.find(tx => [client_proofs_1.ProofId.ACCOUNT, client_proofs_1.ProofId.DEFI_DEPOSIT, client_proofs_1.ProofId.DEPOSIT, client_proofs_1.ProofId.WITHDRAW].includes(tx.proofId)) ||
    txs.find(tx => tx.proofId === client_proofs_1.ProofId.SEND && !tx.isSender) ||
    txs.find(tx => !getFee(tx).value);
const toUserTx = (txs) => {
    const primaryTx = getPrimaryTx(txs);
    if (!primaryTx) {
        return;
    }
    const fee = getTotalFee(txs);
    switch (primaryTx.proofId) {
        case client_proofs_1.ProofId.ACCOUNT: {
            const depositTx = txs.find(tx => tx.proofId === client_proofs_1.ProofId.DEPOSIT);
            const depositValue = depositTx ? getPaymentValue(depositTx) : emptyAssetValue;
            if (depositValue.value) {
                return [toUserAccountTx(primaryTx, emptyAssetValue), toUserPaymentTx(depositTx, depositValue, fee)];
            }
            return [toUserAccountTx(primaryTx, fee)];
        }
        case client_proofs_1.ProofId.DEFI_DEPOSIT: {
            const userDefiTx = toUserDefiTx(primaryTx, fee);
            if (userDefiTx.interactionResult.finalised) {
                return [userDefiTx, toUserDefiClaimTx(primaryTx.claimTxId, userDefiTx)];
            }
            return [userDefiTx];
        }
        default: {
            const value = getPaymentValue(primaryTx);
            return [toUserPaymentTx(primaryTx, value, fee)];
        }
    }
};
const groupTxsByTxRefNo = (txs) => {
    const txGroups = new Map();
    for (const tx of txs) {
        const { txRefNo } = tx;
        if (!txRefNo) {
            // If txRefNo is 0, this tx is not part of a tx group.
            txGroups.set(tx.txId.toBuffer().readUInt32BE(0), [tx]);
        }
        else {
            const group = txGroups.get(txRefNo) || [];
            txGroups.set(txRefNo, [...group, tx]);
        }
    }
    return [...txGroups.values()];
};
const filterUndefined = (ts) => ts.filter((t) => !!t);
const bySettled = (tx1, tx2) => {
    if (tx1.settled && tx2.settled)
        return tx2.settled.getTime() - tx1.settled.getTime();
    if (!tx1.settled && !tx2.settled)
        return 0;
    if (!tx1.settled)
        return -1;
    if (!tx2.settled)
        return 1;
    return 0;
};
const groupUserTxs = (txs) => {
    const txGroups = groupTxsByTxRefNo(txs);
    return filterUndefined(txGroups.map(txs => toUserTx(txs)))
        .flat()
        .sort(bySettled);
};
exports.groupUserTxs = groupUserTxs;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXBfdXNlcl90eHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYXp0ZWNfc2RrL2dyb3VwX3VzZXJfdHhzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLDZEQUFtRTtBQUNuRSxxRUFBNEQ7QUFHNUQsd0NBT29CO0FBRXBCLE1BQU0sZUFBZSxHQUFHLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFFekQsTUFBTSxlQUFlLEdBQUcsQ0FDdEIsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBaUIsRUFDNUcsR0FBZSxFQUNmLEVBQUUsQ0FBQyxJQUFJLHVCQUFhLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFFdkgsTUFBTSxlQUFlLEdBQUcsQ0FDdEIsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQWlCLEVBQ2pGLEtBQWlCLEVBQ2pCLEdBQWUsRUFDZixFQUFFO0lBQ0YsT0FBTyxJQUFJLHVCQUFhLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztBQUN2RyxDQUFDLENBQUM7QUFFRixNQUFNLGlDQUFpQyxHQUFHLENBQUMsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBYyxFQUFFLEVBQUU7SUFDN0YsSUFBSSxZQUFZLEVBQUU7UUFDaEIsT0FBTyx3Q0FBOEIs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